<!doctype html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin — Monthly Grid Upload</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href="/static/styles.css" rel="stylesheet" />
  </head>
  <body>
    <main class="container py-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Admin — Monthly Grid Upload</h3>
        <a class="btn btn-outline-secondary btn-pill" href="/"
          >← Back to Timesheets</a
        >
      </div>
      <p class="text-secondary small">
        Grid format: Citi Email, Project Code, optional Billing Rate, and day
        columns 1..31.
      </p>
      <div class="row g-3 align-items-end">
        <div class="col-md-2">
          <label class="form-label">System</label>
          <select class="form-select" id="sys">
            <option value="CG">CG</option>
            <option value="CITI">CITI</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Month</label>
          <input type="month" class="form-control" id="gMonth" />
        </div>
        <div class="col-md-5">
          <label class="form-label">Excel File</label>
          <div class="input-group">
            <input
              type="file"
              class="form-control"
              id="gridFile"
              accept=".xlsx,.xls"
            />
            <button class="btn btn-outline-primary btn-pill" id="uploadGridBtn">
              Upload Grid
            </button>
          </div>
        </div>
      </div>
      <p class="mt-3 text-secondary" id="msg"></p>
    </main>
    <script>
      const msg = document.getElementById("msg");
      document
        .getElementById("uploadGridBtn")
        .addEventListener("click", async () => {
          const system = document.getElementById("sys").value;
          const m = document.getElementById("gMonth").value;
          const f = document.getElementById("gridFile").files[0];
          if (!system || !m || !f) {
            msg.textContent = "Please select system, month and file.";
            return;
          }
          const fd = new FormData();
          fd.append("system", system);
          fd.append("month", m);
          fd.append("file", f);
          const res = await fetch("/api/admin/upload-monthly-grid", {
            method: "POST",
            body: fd,
          });
          const data = await res.json();
          msg.textContent = res.ok
            ? "Grid uploaded."
            : data.detail || "Upload failed";
        });
      window.addEventListener("DOMContentLoaded", () => {
        const now = new Date();
        document.getElementById("gMonth").value = `${now.getFullYear()}-${String(
          now.getMonth() + 1
        ).padStart(2, "0")}`;
      });
    </script>
  </body>
</html>